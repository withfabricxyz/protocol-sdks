#!/bin/bash

if [ "${CONTRACTS_DIR}" = '' ]; then
  echo "CONTRACTS_DIR not set"
  exit 1
fi

TARGET_FILE="src/bytecode.ts"

echo '// This file is auto-generated by scripts/import_bytecode.sh' > $TARGET_FILE

contracts="CrowdFinancingV1 CrowdFinancingV1Factory ERC20Token"
for contract in $contracts; do
  echo "Importing Bytecode for contract ${contract} -> ${TARGET_FILE}"
  bytecode=$(cat ${CONTRACTS_DIR}/out/${contract}.sol/${contract}.json | jq -rj .bytecode.object)

  echo "// Bytecode for ${contract}">> $TARGET_FILE
  echo "export const ${contract}Bytecode = '${bytecode}';" >> $TARGET_FILE
  echo >> $TARGET_FILE
done
